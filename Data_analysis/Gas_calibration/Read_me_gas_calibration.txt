This is a brief guide on MIMS_CO2_calib.py

MIMS_CO2_calib.py is used to calibrate CO2 and O2 signals so that it can also\
translate mass spec signals into O2 (mass 32), CO2 (mass 44, 45, 47, 49)\
concentrations. The  input files are generated by Pfeiffer Vacuum’s QUADERA® \
mass spectrometer software during experiments.

MIMS_CO2_calib.py has five sections for signal calibration and calculating gas
concentrations. Mass 40 (Ar) is used to correct O2 signals. Here are some brief\
descriptions of each section:

First,
#### calculate minimum CO2 currents and dCO2/dO2 ====####
This section takes the data file with minimum CO2 signals measured with 0.1 NaOH \
or after adding 25 µL 10 M NaOH into ~1.2 mL 0.1 N HCl after CO2 calibrations.\
This section also estimates the mass 32 impact on mass 44 and mass 45, which is \
likely due to the presence of 12C/13C in tungsten filament.
In the experiments done with Fragilariopsis cylindrus, the latter was the case.\
so the sample input file name is
    filename = 'CO2_wo_47_49_CO2_calib.asc'
# For different experiments other than the sample data, one should adjust the \
# index numbers used to get minimum/maximum values.

Second,
#### calibrate O2,  process H2O followed by Na2S2O4 ====####
This section reads the data from O2 calibration where Na2S2O4 was added to air \
equilibrated dI H2O or 40‰ seawater for freezing temperature (-2°C). Here sample  \
input file is
    f2 = 'CO2_wo_47_49_O2_calib.asc'
Note for different temperature, one needs to change the temperature in the \
equation:\
    O2_sat = O2_sol(3,0)# this will be different at different temperature
# For different experiments other than the sample data, one should adjust the \
# index numbers used to get minimum/maximum values.

Third,
#### calibrate CO2 concentration vs signal ====####
This section reads data from a typical CO2 calibration experiments:
adding 3 µL   1 mM 13C-NaHCO3 into 1.2 mL 0.1 N HCl ------- X 3 times
adding 3 µL  10 mM 13C-NaHCO3 into 1.2 mL 0.1 N HCl ------- X 3 times
adding 3 µL 100 mM 13C-NaHCO3 into 1.2 mL 0.1 N HCl ------- X 1 time
adding 25 µL 10 M NaOH into above reaction mix, which can be followed by adding
Na2S2O4 to the chamber to get O2/CO2 signal relation (see First section)

This experiment generates a data file like:
    f_calib = 'CO2_wo_47_49_CO2_calib.asc'
the analysis section will attempt to find the timepoints of adding NaHCO3. If the\
identified timepoints are off, one needs to adjust the variable:
    thresholds =[1.0, 1.5, 1.0, 15, 12, 12, 150]

The background 13C-CO2 is treated as zero so that when curve fitting the relation\
between [CO2] and mass spec signal (unit in A), y= k*x can be used as the function.

The expected concentrations are assigned as c:
c = np.array([0, 3/1203, 6/1206, 9/1209, 39/1212, 69/1215, 99/1218,\
          399/1221])#unit mM
One needs to adjust those numbers if the experimental set up is different.

Even though seven (plus a forced baseline zero point) points are available for \
curve fit, currently the code only takes four points for the slope k value,\
so that the slope uses data ≤30 µM of CO2 calibration. As stated in the associated
manuscript, the 7-point and 4-point fit curve do not differ much.

In addition to the slope value, the fraction of 13C (13C/(13C+12C), assigned as \
f13C) is calculated to correct real concentrations for CO2. \
Overtime, the fraction of 13C decreases slowly from stock ~0.985
    So [CO2] = netCO2_signal * k* f13C
See I_to_c function for more.

After this section, a parameter file (*mins_pras.csv)\
storing calibration factors is saved.

Fourth,
#### convert I to c for exp file ####
This section takes the parameters calculated from 1st to 3rd section and convert\
mass spectrometer reading data file to \
a file storing time and CO2 and O2 concentrations.
Here, the experiment with AZ (eCA inhibitor) is processed.
    f_exp = 'Fcyl_3C_S40_exp01_wAZ.asc'
Note that Ar is used to correct O2 signal. The key function in this section is
I_to_c function.

Fifth,
#### convert exp02 I to c####
Process second experiment without AZ
    f_exp2 = 'Fcyl_3C_S40_exp02_noAZ.asc'

The whole script output three files:
1, parameter file: "*mins_pras.csv"
2, [CO2]&[O2] data with AZ "*exp01_c.csv"
3, [CO2]&[O2] data without AZ "*exp02_c.csv"

the [CO2] and [O2] data files are used in fit_CO2_*.py to calculate physiochemical\
photosynthetic/respiratory and carbon usage numbers.

It is recommended to go through section by section before converting mass spec \
data file into gas concentration files. One should pay attention to time indexes\
when calculating parameters for converting current (mass spec reading) \
to concentrations.

The script was tested last time on March 10th, 2022, within Python 3.7.6 using
Spyder 4.0.1
